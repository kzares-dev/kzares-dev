---
import { getCollection } from "astro:content";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import Layout from "../../layouts/Layout.astro";
import CollectionSection from "../../components/CollectionSection.astro";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const collections = (await getCollection("category")).sort(
	(a, b) => a.data.title.localeCompare(b.data.title),
);

// Agrupar posts por colección
const postsByCollection = new Map();
for (const collection of collections) {
	const collectionId = collection.id.replace('.md', '');
	postsByCollection.set(collectionId, posts.filter(p => p.data.collection === collectionId));
}
---

<Layout>
	<Header />
	<main>
		<div class="blog-header">
			<h1>Blog</h1>
			<p>Últimos artículos</p>
		</div>
		{
			collections.map((collection) => {
				const collectionId = collection.id.replace('.md', '');
				const collectionPosts = postsByCollection.get(collectionId) || [];
				return (
					<CollectionSection collection={collection} posts={collectionPosts} />
				);
			})
		}
	</main>
	<Footer />
</Layout>

<style>
	.blog-header {
		text-align: center;
		margin-bottom: 3rem;
		padding: 2rem 0;
	}

	.blog-header h1 {
		font-size: 2.5rem;
		margin-bottom: 0.5rem;
	}

	.blog-header p {
		font-size: 1.1rem;
		color: #666;
	}
</style>
